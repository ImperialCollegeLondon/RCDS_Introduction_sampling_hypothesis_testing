---
title: "Introduction to random sampling and hypothesis testing"
author: "Research Computing and Data Science: Jesus Urtasun; jurtasun@ic.ac.uk"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  rmdformats::robobook:
    self_contained: true
    code_folding: hide
    thumbnails: false
    lightbox: true
    gallery: false
    highlight: tango
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r import, cache = T, echo = T, eval = T, warnings = F, messages = F}

# Import libraries

# Set working directory
workdir <- "/Users/jurtasun/Desktop/Courses/ICL/RCDS_Introduction_sampling_hypothesis_testing/Chapter2"
setwd(workdir)

set_plot_dimensions <- function(width_choice, height_choice) {
    options(repr.plot.width = width_choice, repr.plot.height = height_choice)
}

```

# Chapter 2

## 2.2 Sampling and confidence intervals

In this chapter we will describe one of the most fundamental results in statistical inference. The central limit theorem (CLT) states that the distribution of sample means, meaning the mean values computed for a set of different experiments, approximates a normal distribution as the sample size gets larger, regardless of the population's distribution. Sample sizes equal to or greater than 30 are often considered sufficient for the CLT to hold.

### Standard normal distribution

```{r standard, cache = T, echo = T, eval = T, warnings = F, messages = F}

# Standard normal distribution
mu <- 0
sigma <- 1

# Probability density function
wid <- 0.01
x <- seq(-4, 4, wid)
pdf <- dnorm(x, mu, sigma)
set_plot_dimensions(5, 4)
plot(x, pdf, xlab = "x", type = "l", col = "red")
     
# Plot cumulative distribution function
cdf <- pnorm(x, mu, sigma)
set_plot_dimensions(5, 4)
plot(x, cdf, xlab = "x", ylim = c(0, 1), type = "l", col = "blue")

# one sigma
pnorm(1, mu, sigma) - pnorm(-1, mu, sigma)
     
# two sigma
pnorm(2, mu, sigma) - pnorm(-2, mu, sigma)
     
# three sigma
pnorm(3, mu, sigma) - pnorm(-3, mu, sigma)

alpha <- 0.1  # how much probability will remain in the tails

qnorm(alpha/2, mu, sigma)  # the critical value for the lower tail
qnorm(1-alpha/2, mu, sigma) # the critical value for the upper tail = z90

# plot the probability density function
plot(x, pdf, xlab = "x", type = "l", col = "red")

# the shaded region contains 90% of the probability mass
z90 <- qnorm(1-alpha/2, mu, sigma)
x_region = seq(-z90, z90, wid)
polygon(c(x_region, z90, -z90), c(dnorm(x_region, mu, sigma), 0, 0), border = NA, col = "lightgrey")

#95%
qnorm(1-0.05/2, mu, sigma)

#99%
qnorm(1-0.01/2, mu, sigma)

```

### Confidence intervals for large n - z distribution

```{r confidence1, cache = T, echo = T, eval = T, warnings = F, messages = F}

data <- c(265848, 256680, 248124, 310155, 265848, 201182, 232617,
       206770, 275694, 286297, 265848, 256680, 286297, 275694,
       338351, 323640, 372187, 297749, 297749, 206770, 323640,
       240120, 232617, 310155, 275694, 225568, 465233, 310155,
       256680, 206770, 354463, 265848, 286297, 275694, 275694,
       232617, 297749, 265848, 310155, 186093, 354463, 240120,
       232617, 265848, 286297, 248124, 275694, 286297, 310155,
       232617, 256680, 218933, 297749, 391775, 206770, 256680,
       248124, 338351, 265848, 225568, 190865, 297749, 465233,
       323640)

# first, calculate the sample mean and s.d.
xbar <- mean(data)
xbar

s <- sd(data)  ## sd() uses the unbiased estimator
s
     
# now find the critical value
z95 <- qnorm(1-0.05/2,mu,sigma)
z95

# finally calculate the 95% confidence interval for mu
ci <- c(xbar - z95 * s / sqrt(64) , xbar + z95 * s / sqrt(64))
ci

```

### Confidence intervals for small n - t-distribution

```{r confidence2, cache = T, echo = T, eval = T, warnings = F, messages = F}

x <- seq(-4, 4, 0.01)
plot(x, dnorm(x, mean = 0, sd = 1), xlab = "x", type = "l", col = 'grey')
lines(x, dt(x, df = 1), col = "red")

data <- c(5, 1, 6, 3, 2, 4, 2, 7, 1, 0)

# first, calculate the sample mean and s.d.
xbar <- mean(data)
xbar

s <- sd(data)
s
     
# now find the critical value
t95 <- qt(1-0.05/2, df = 9)  # df = n-1
t95
     

# finally calculate the 95% confidence interval for mu
ci <- c(xbar - t95 * s / sqrt(10) , xbar + t95 * s / sqrt(10))
ci

```
